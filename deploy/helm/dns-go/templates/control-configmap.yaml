{{- if .Values.control.enabled }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "dns-go.fullname" . }}-control
  labels:
    {{- include "dns-go.control.labels" . | nindent 4 }}
data:
  config.yaml: |
    mode: control
    control_plane:
      grpc_address: "{{ .Values.control.config.grpcAddress }}"
      heartbeat_timeout: {{ .Values.control.config.heartbeatTimeout }}
    api:
      enabled: {{ .Values.control.config.api.enabled }}
      listen_address: "{{ .Values.control.config.api.listenAddress }}"
      cors_origins:
        {{- toYaml .Values.control.config.api.corsOrigins | nindent 8 }}
      auth:
        username: {{ .Values.control.config.api.auth.username }}
        jwt_secret: "{{ .Values.control.config.api.auth.jwtSecret }}"
        token_expiry: {{ .Values.control.config.api.auth.tokenExpiry }}
    logging:
      level: {{ .Values.control.config.logging.level }}
      format: {{ .Values.control.config.logging.format }}
      enable_query_log: {{ .Values.control.config.logging.enableQueryLog }}
{{- end }}
